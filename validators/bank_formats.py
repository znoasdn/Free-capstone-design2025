"""
은행별 계좌번호 형식 정리 (2025.12 기준)

[범례]
- X: 지점코드/기관코드
- Y: 과목코드 (계좌종류)
- Z: 일련번호
- C: 체크디짓
- B: 고객지정번호/기타
- T: 업무구분
- N: 숫자



"""

# 은행별 계좌번호 형식 상세
BANK_ACCOUNT_FORMATS = {
    
    # =========================================================
    # 2.1. 한국산업은행 (KDB)
    # =========================================================
    '한국산업은행': {
        'formats': [
            {'length': 11, 'pattern': 'XXX-YY-ZZZZZC', 'type': '구계좌'},
            {'length': 14, 'pattern': 'YYY-ZZZZZZZ-C-XXX', 'type': '현행'},
            {'length': 14, 'pattern': 'YYY-ZZZZZZZZ-XXX', 'type': '가상(평생계좌/정기적금)'},
        ],
        'subject_codes': {
            '구계좌': {'보통': '13', '저축': '20', '자유저축': '19', '당좌': '11', '기업자유': '22'},
            '신계좌': {'보통': '013', '저축': '020', '자유저축': '019', '당좌': '011', '기업자유': '022'},
        },
    },
    
    # =========================================================
    # 2.2. 중소기업은행 (IBK)
    # =========================================================
    'IBK기업은행': {
        'formats': [
            {'length': 10, 'pattern': 'BBBBBBBBB-ZZ', 'type': '평생계좌(구)'},
            {'length': 11, 'pattern': 'AAA-BBBBBBBB', 'type': '평생계좌(구)'},
            {'length': 12, 'pattern': 'XXX-YY-ZZZZZZ-C', 'type': '현행'},
            {'length': 14, 'pattern': 'XXX-BBBBBB-YY-ZZC', 'type': '현행'},
        ],
        'subject_codes': {
            '보통': '01',
            '저축': ['02', '03', '13'],
            '가계당좌': '07',
            '당좌': '06',
            '기업자유': '04',
        },
        'notes': '평생계좌는 2012년 11월 12일자로 신규등록 중단 추정',
    },
    
    # =========================================================
    # 2.3. KB국민은행
    # =========================================================
    'KB국민은행': {
        'formats': [
            {'length': 12, 'pattern': 'XXX-YY-ZZZZ-ZZC', 'type': '구 국민은행'},
            {'length': 14, 'pattern': 'XXXXXX-YY-ZZZC', 'type': '구 한국주택은행(당좌)'},
            {'length': 14, 'pattern': 'XXXX-YY-ZZZZZZZ-C', 'type': '구 한국주택은행'},
            {'length': 14, 'pattern': 'XXXXYY-ZZ-ZZZZZC', 'type': '현행'},
        ],
        'subject_codes': {
            '국민은행': {'보통': '01', '국고': '01', '저축': '02', '자유저축': '24', '가계당좌': '05', '당좌': '04', '기업자유': '25', '연계': '26'},
            '구_주택은행': {'보통': '01', '국고': '01', '저축': '02', '자유저축': '25', '가계당좌': '06', '당좌': '18', '기업자유': '37', '연계': '90'},
        },
        'notes': '평생계좌번호 첫자리 9→현재 00',
    },
    
    # =========================================================
    # 2.4. 하나은행 (KEB하나)
    # =========================================================
    'KEB하나은행': {
        'formats': [
            {'length': 11, 'pattern': 'XXX-YY-ZZZZZ-C', 'type': '구 외환은행(입금전용)'},
            {'length': 12, 'pattern': 'YYY-ZZZZZZ-ZZC', 'type': '구 외환은행(입금전용)'},
            {'length': 14, 'pattern': 'XXX-ZZZZZZ-ZZCYY', 'type': '하나은행(현행)'},
        ],
        'subject_codes': {
            '구_외환_11자리': {'보통': ['13', '33'], '저축': ['18', '38'], '자유저축': ['19', '39'], '가계당좌': '26', '당좌': '11', '기업자유': '22'},
            '구_외환_12자리': {'보통': '611', '국고': '610', '저축': '620', '가계당좌': '600', '당좌': '601', '기업자유': '630', 'YES': ['621', '631']},
            '하나은행': {'보통': '05', '저축': '07', '자유저축': '08', '가계당좌': '02', '당좌': '01', '기업자유': '04', '연계': '94'},
        },
        'virtual_code': '370',  # 14자리 가상계좌
        'extra_codes': {
            '정기적금': ['15', '810'],
            '자유적립식적금': '811',
            '부금': ['23', '817', '818'],
            '근로자우대저축': ['24', '814'],
            '장기주택마련저축': ['29', '815'],
            '연금신탁': '70',
            '적립식목적신탁': '73',
            '기업금전신탁': ['74', '704'],
            '가계금전신탁': ['75', '705'],
            '노후연금신탁': ['77', '707'],
            '신탁기타': ['700', '703', '710', '711', '712', '713', '714', '715', '716'],
        },
    },
    
    # =========================================================
    # 2.5. 수협중앙회
    # =========================================================
    '수협중앙회': {
        'formats': [
            {'length': 11, 'pattern': 'XXX-YY-ZZZZZ-C', 'type': '기존'},
            {'length': 12, 'pattern': 'YYYZ-ZZZZ-ZZZC', 'type': '현행'},
            {'length': 12, 'pattern': '0-시작', 'type': '맞춤계좌'},
            {'length': 14, 'pattern': 'XXX-YY-ZZZZZZZZ-C', 'type': '가상계좌'},
        ],
        'subject_codes': {
            '11자리': {'보통': '01', '저축': '02', '가계당좌': '06', '당좌': '08'},
            '12자리': {'보통': ['101', '201'], '저축': ['102', '202', '209'], '자유저축': ['103', '208'], '가계당좌': '106', '당좌': '108', '기업자유': ['113', '114', '206']},
        },
    },
    
    # =========================================================
    # 2.6. NH농협은행
    # =========================================================
    'NH농협은행': {
        'formats': [
            {'length': 11, 'pattern': 'XXX-YY-ZZZZZC', 'type': '구계좌(11자리)'},
            {'length': 12, 'pattern': 'XXXX-YY-ZZZZZC', 'type': '구계좌(12자리)'},
            {'length': 13, 'pattern': 'YYY-ZZZZ-ZZZZ-CT', 'type': '신계좌'},
            {'length': 14, 'pattern': 'XXXXXX-YY-ZZZZZC', 'type': '가상(구)'},
            {'length': 15, 'pattern': 'YYY-ZZZZ-ZZZZ-ZZC', 'type': '가상(신)'},
        ],
        'subject_codes': {
            '보통': '01',
            '저축': '02',
            '자유저축': '12',
            '가계당좌': '06',
            '당좌': '05',
            '기업자유': '17',
        },
        'virtual_codes': ['64', '65', '790', '791'],
        'extra_codes': {
            '적금': ['04', '10', '14', '21', '24', '34', '45', '47', '49', '59', '80'],
            '신탁': ['28', '31', '43', '46', '79', '81', '86', '87', '88'],
        },
        'notes': '13자리는 과목코드 앞에 3을 붙여 3자리로',
    },
    
    # =========================================================
    # 2.7. 농업협동조합 (단위농협)
    # =========================================================
    '단위농협': {
        'formats': [
            {'length': 14, 'pattern': 'XXXXXX-YY-ZZZZZC', 'type': '구계좌'},
            {'length': 13, 'pattern': 'YYY-ZZZZ-ZZZZ-CT', 'type': '신계좌'},
            {'length': 14, 'pattern': 'XXXXXX-YY-ZZZZZC', 'type': '가상(구)'},
            {'length': 15, 'pattern': 'YYY-ZZZZ-ZZZZ-ZZC', 'type': '가상(신)'},
        ],
        'subject_codes': {
            '보통': '51',
            '저축': '52',
            '자유저축': '56',
            '기업자유': '55',
        },
        'virtual_codes': ['66', '67', '792'],
        'extra_codes': {
            '적금': ['354', '360', '384', '394', '398'],
            '신탁': '028',
        },
        'notes': '13자리는 과목코드 앞에 3을 붙여 3자리로',
    },
    
    # =========================================================
    # 2.8. 우리은행
    # =========================================================
    '우리은행': {
        'formats': [
            {'length': 13, 'pattern': 'SYYY-CZZ-ZZZZZZ', 'type': '통합 우리은행'},
            {'length': 14, 'pattern': 'XXX-BBBBBC-YY-ZZC', 'type': '연계계좌'},
            {'length': 11, 'pattern': 'XXX-YY-ZZZZZC', 'type': '구 한국상업은행'},
            {'length': 14, 'pattern': 'XXX-BBBBBB-YY-ZZC', 'type': '구 한일은행'},
            {'length': 12, 'pattern': 'XXX-YY-ZZZZZZZC', 'type': '구 평화은행'},
        ],
        'subject_codes': {
            '우리은행': {'보통': '006', '국고': '007', '저축': '002', '자유저축': '002', '가계당좌': '004', '당좌': '003', '기업자유': '005'},
            '구_상업': {'보통': '05', '저축': ['06', '07'], '자유저축': '08', '가계당좌': '02', '당좌': '01', '기업자유': '04'},
            '구_한일': {'보통': '01', '국고': '15', '저축': '02', '자유저축': '12', '가계당좌': '04', '당좌': '03', '기업자유': '13'},
            '구_평화': {'보통': '01', '저축': '21', '자유저축': '24', '가계당좌': '05', '당좌': '04', '기업자유': '25', '연계': '09'},
        },
        'virtual_codes': {'가상보통예금': '18', '가상당좌예금': '92'},
    },
    
    # =========================================================
    # 2.9. SC제일은행
    # =========================================================
    'SC제일은행': {
        'formats': [
            {'length': 11, 'pattern': 'XXX-YY-ZZZZZC', 'type': '일반'},
            {'length': 14, 'pattern': 'XXX-YY-ZZZZZZZC', 'type': '가상계좌'},
        ],
        'subject_codes': {
            '보통': '10',
            '국고': '10',
            '저축': '20',
            '자유저축': '20',
            '가계당좌': '30',
            '당좌': '30',
            '기업자유': '20',
        },
        'virtual_codes': ['15', '16'],
    },
    
    # =========================================================
    # 2.10. 신한은행
    # =========================================================
    '신한은행': {
        'formats': [
            {'length': 12, 'pattern': 'YYY-ZZZ-ZZZZZC', 'type': '신한 신계좌'},
            {'length': 14, 'pattern': 'YYY-TTT-ZZZZZZZC', 'type': '신한 신계좌(가상)'},
            {'length': 11, 'pattern': 'XXX-YY-ZZZZZC', 'type': '구 조흥은행'},
            {'length': 14, 'pattern': 'XXX-YY-ZZZZZZZC', 'type': '구 조흥은행(가상)'},
            {'length': 11, 'pattern': 'XXX-YY-ZZZZZC', 'type': '구 신한은행'},
            {'length': 14, 'pattern': 'XXX-YYY-ZZZZZZZC', 'type': '구 신한은행(가상)'},
        ],
        'subject_codes': {
            '신계좌': {'보통': ['100', '101', '102', '103', '104', '105', '106', '107', '108', '109', '160', '161'], '저축': ['110', '111', '112', '113', '114', '115', '116', '117', '118', '119', '120', '121', '122', '123', '124', '125', '126', '127', '128', '129', '130', '131', '132', '133', '134', '135', '136', '137', '138', '139'], '가계당좌': ['155', '156', '157', '158', '159'], '당좌': ['150', '151', '152', '153', '154'], '기업자유': ['140', '141', '142', '143', '144', '145', '146', '147', '148', '149']},
            '구계좌': {'보통': '01', '저축': ['02', '11', '13'], '자유저축': '12', '가계당좌': '03', '당좌': '04', '기업자유': '05'},
            '구_조흥': {'보통': ['01', '09', '61'], '저축': ['04', '05'], '자유저축': ['06', '08'], '가계당좌': '02', '당좌': '07', '기업자유': ['03', '07']},
        },
        'virtual_codes': {
            '신한_신계좌': ['560', '561', '562'],
            '신한_구계좌': ['99', '901'],
            '구_조흥': ['81', '82'],
        },
        'extra_codes': {
            '청년희망펀드_공익신탁': ['298', '268', '269'],
        },
    },
    
    # =========================================================
    # 2.11. 한국씨티은행
    # =========================================================
    '한국씨티은행': {
        'formats': [
            {'length': 14, 'pattern': 'XXX-ZZZZZ-YYC-ZZ', 'type': '통합 씨티(개인)'},
            {'length': 14, 'pattern': 'T-BBBBBB-CYY-ZZ', 'type': '통합 씨티(기업)'},
            {'length': 11, 'pattern': 'XXX-ZZZZZ-YYC', 'type': '구 한미은행'},
            {'length': 11, 'pattern': 'XX-YY-ZZZZZC', 'type': '구 씨티은행'},
            {'length': 11, 'pattern': 'Y-ZZZZZZ-ZZC', 'type': '구 씨티은행'},
        ],
        'subject_codes': {
            '씨티_신계좌_구_한미': {'보통': ['01', '11', '21', '25', '31', '42', '51', '71', '81'], '국고': '23', '저축': ['05', '06', '15', '26', '29'], '자유저축': ['07', '27', '55'], '가계종합예금': '99', '당좌': ['03', '13', '33', '41', '43', '53', '63'], '기업자유': '24'},
            '씨티_구계좌': {'보통': ['20', '21', '32', '34', '36', '37', '38', '42', '46', '70', '71', '73', '74', '75', '76', '77', '78', '80', '81', '83', '84', '85', '86', '87', '88', '91', '92', '93', '94', '95', '96', '99'], '저축': ['30', '33', '35', '41', '43', '44', '45', '50', '51', '52', '53', '54', '55', '56', '57', '58', '63', '64'], '자유저축': ['60', '61', '62', '63', '64', '65', '66', '67', '68', '69'], '가계종합예금': ['40', '48'], '당좌': ['00', '01', '02', '03', '04', '05', '06', '07', '08', '09', '10', '11', '12', '13', '14', '15', '16', '17', '18', '19'], '기업자유': '59'},
        },
        'corporate_codes': ['25', '41', '24', '18'],
    },
    
    # =========================================================
    # 2.12. 대구은행 (DGB)
    # =========================================================
    '대구은행': {
        'formats': [
            {'length': 11, 'pattern': 'XXX-YY-ZZZZZC', 'type': '구형'},
            {'length': 12, 'pattern': 'XXX-YY-ZZZZZZC', 'type': '구형'},
            {'length': 12, 'pattern': 'YYY-ZZ-ZZZZZZZC', 'type': '현행'},
            {'length': 14, 'pattern': 'XXX-YY-ZZZZZZ-ZZZ', 'type': '구형'},
        ],
        'subject_codes': {
            '2자리': {'보통': ['05', '10'], '저축': ['06', '07'], '자유저축': '08', '가계당좌': '02', '당좌': '01', '기업자유': ['04', '12']},
            '3자리': {'보통': '505', '저축': '508', '가계당좌': '502', '당좌': '501', '기업자유': '504'},
        },
        'extra_codes': {
            '국민주청약예금': '06',
            '신자유저축': ['13', '14'],
            '근로자우대저축': ['19', '519'],
            '비과세가계장기저축': ['20', '520'],
            '가계우대정기적금': ['21', '521'],
            '재형저축': '524',
            '상호부금': ['25', '525'],
            '평생저축': ['27', '527'],
            '장기주택마련적금': ['28', '528'],
        },
        'notes': '현재는 YYY 패턴으로만 발급',
    },
    
    # =========================================================
    # 2.15. 새마을금고
    # =========================================================
    '새마을금고': {
        'formats': [
            {'length': 13, 'pattern': '9YYY-ZZZZ-ZZZZ-C', 'type': '현행'},
            {'length': 13, 'pattern': 'XXXX-YY-ZZZZZZ-C', 'type': '2009.09.21 이전'},
            {'length': 14, 'pattern': 'XXXX-YYY-ZZZZZZ-C', 'type': '2009.09.21 이전'},
        ],
        'subject_codes': {
            '구_13자리': ['09', '10', '13', '37'],  # 37=가상
            '구_14자리': ['801', '802', '803', '804', '805', '806', '807', '808', '809', '810', '851', '852', '853', '854', '855', '856', '857', '858', '859', '860'],
            '현행': ['002', '003', '004', '072', '090', '091', '092', '093'],
        },
        'extra_codes': {
            '입금전용': ['200', '202', '205', '207', '208', '209', '210', '212'],
            '기업자유': '005',
        },
        'notes': '지점코드는 금고코드',
    },
    
    # =========================================================
    # 2.16. 케이뱅크
    # =========================================================
    '케이뱅크': {
        'formats': [
            {'length': 12, 'pattern': 'YYY-NNN-ZZZZZZ', 'type': '개인/법인 실계좌'},
            {'length': 10, 'pattern': '9-NNNNNNNNN', 'type': '비대면 실명인증 입금전용'},
            {'length': 13, 'pattern': 'ZZ(Z)-NNN-NNNN-NNN', 'type': '휴대폰번호 연결서비스'},
            {'length': 14, 'pattern': '(7/9)-NNNN-NNN-NNNN', 'type': '간편송금/안심계좌/신용카드결제'},
            {'length': 14, 'pattern': 'ZZZZZZZZZZZZ-ZZ', 'type': '여신가상계좌'},
        ],
        'subject_codes': {
            '입출금': '100',
        },
    },
    
    # =========================================================
    # 2.17. 카카오뱅크
    # =========================================================
    '카카오뱅크': {
        'formats': [
            {'length': 13, 'pattern': 'TYYY-ZZ-ZZZZZZZ', 'type': '일반'},
        ],
        'subject_codes': {
            '일반계좌': {'입출금': '333', '정기예금': '388', '자유적금': '355', '저금통(세이프박스)': '310'},
            '가상계좌': {'mini': '777', '모임통장': '979'},
        },
        'business_type': {
            '일반계좌': '3',
            '가상계좌': '7',
        },
    },
    
    # =========================================================
    # 2.18. 토스뱅크
    # =========================================================
    '토스뱅크': {
        'formats': [
            {'length': 12, 'pattern': 'YYYZ-ZZZZ-ZZZC', 'type': '일반'},
        ],
        'subject_codes': {
            '입출금': '100',
            '모으기': '106',
            '적금': '300',
            '토스머니': '190',
        },
        'notes': '토스머니는 일련번호 첫자리 8, 나머지는 0',
    },
}


def get_valid_lengths_by_bank(bank_name: str) -> list:
    """은행별 유효 계좌번호 길이 반환"""
    if bank_name not in BANK_ACCOUNT_FORMATS:
        return []
    
    formats = BANK_ACCOUNT_FORMATS[bank_name].get('formats', [])
    return list(set(f['length'] for f in formats))


def get_all_valid_lengths() -> set:
    """모든 은행의 유효 계좌번호 길이 반환"""
    lengths = set()
    for bank_data in BANK_ACCOUNT_FORMATS.values():
        for fmt in bank_data.get('formats', []):
            lengths.add(fmt['length'])
    return lengths


def get_banks_by_length(length: int) -> list:
    """특정 길이의 계좌번호를 사용하는 은행 목록"""
    banks = []
    for bank_name, bank_data in BANK_ACCOUNT_FORMATS.items():
        for fmt in bank_data.get('formats', []):
            if fmt['length'] == length:
                banks.append({'bank': bank_name, 'type': fmt['type'], 'pattern': fmt['pattern']})
    return banks
