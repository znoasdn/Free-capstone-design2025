"""
상수 정의 모듈
개인정보보호법 + 부정경쟁방지법 기반 분류 체계

법적 근거:
- 개인정보: 제2조 (살아있는 개인을 식별할 수 있는 정보)
- 고유식별정보: 제24조, 시행령 제19조 (주민등록번호, 여권번호, 운전면허번호, 외국인등록번호)
- 민감정보: 제23조 (사상·신념, 노동조합·정당 가입/탈퇴, 정치적 견해, 건강, 성생활 등)
- 노출금지 정보: 제34조의2 (고유식별정보, 계좌정보, 신용카드정보)
- 영업비밀: 부정경쟁방지법 제2조 제2호 (기업의 비밀정보로서 경제적 가치를 가지는 정보)
"""
import re

# ============================================================
# 파일 및 서버 설정
# ============================================================
MAX_FILE_SIZE = 50 * 1024 * 1024  # 50MB
SUPPORTED_EXTENSIONS = ['.pdf', '.docx', '.txt', '.hwp', '.hwpx']

OLLAMA_URL = "http://localhost:11434/api/generate"
OLLAMA_TAGS_URL = "http://localhost:11434/api/tags"
OLLAMA_TIMEOUT = 30

AVAILABLE_MODELS = {
    "llama3.2:3b": "빠르고 안정적, 가장 무난한 선택",
    "qwen2.5:3b": "빠른 처리 및 프롬프트 특화",
    "phi3.5:3.8b": "뛰어난 추론 능력, 논리적 분석",
    "exaone3.5:2.4b": "한국어 특화, 국내 데이터 최적화",
    "exaone-deep:7.8b": "한국어 특화, 3.5b보다 뛰어난 성능",
    "gemma3:1b": "초고속 처리, 빠른 응답 (기본 분석)",
    "gemma3:4b": "고속 처리, 정확도 우수한 응답"
}

# ============================================================
# 개인정보 분류 체계 (개인정보보호법 기준)
# ============================================================

# 1. 고유식별정보 (제24조, 시행령 제19조)
#    - 법적으로 가장 엄격한 보호 대상
#    - 처리 제한, 암호화 의무 등 적용
UNIQUE_IDENTIFIERS = {
    "주민등록번호": "주민등록법 제7조의2",
    "여권번호": "여권법 제7조",
    "운전면허번호": "도로교통법 제80조",
    "외국인등록번호": "출입국관리법 제31조"
}

# 2. 민감정보 (제23조)
#    - 사생활을 현저히 침해할 우려가 있는 정보
SENSITIVE_INFO_CATEGORIES = {
    "사상_신념": ["종교", "신앙", "사상", "철학", "세계관"],
    "노동조합_정당": ["노동조합", "노조", "정당", "당원", "조합원"],
    "정치적_견해": ["정치적 성향", "지지정당", "투표", "정치 활동"],
    "건강정보": ["병력", "진단", "처방", "의료기록", "건강검진", "질병", "장애"],
    "성생활": ["성적 지향", "성생활"],
    "유전정보": ["DNA", "유전자", "유전자검사"],
    "범죄경력": ["범죄", "전과", "형사기록", "수사기록"]
}

# 3. 일반 개인정보 (제2조)
#    - 개인을 식별할 수 있는 일반적인 정보
GENERAL_PERSONAL_INFO = {
    "연락처": ["전화번호", "휴대전화"],
    "이메일": ["이메일"],
    "주소": ["주소"],
    "성명": ["이름", "성명"]
}

# 4. 노출금지 정보 (제34조의2)
#    - 정보통신망을 통해 공중에 노출되지 않도록 해야 함
#    - 고유식별정보 + 금융정보
EXPOSURE_PROHIBITED_INFO = [
    "주민등록번호", "여권번호", "운전면허번호", "외국인등록번호",  # 고유식별정보
    "계좌번호", "카드번호"  # 금융정보
]

# ============================================================
# 민감정보 정규식 패턴 (탐지용)
# 공백/하이픈 변형 대응: \s*-?\s* 패턴 사용
# ============================================================
SENSITIVE_PATTERNS = {
    # --- 고유식별정보 (제24조) ---
    # 주민등록번호: 공백/하이픈 변형 대응
    "주민등록번호": r'(?<!\d)\d{6}\s*[-]?\s*[1-4]\d{6}(?!\d)',
    # 여권번호: 3가지 형식 지원
    # 1) 기존: 알파벳1 + 숫자8 (M12345678)
    # 2) 차세대: 알파벳1 + 숫자3 + 알파벳1 + 숫자4 (M123A4567) - 2021.12.21~
    # 3) 구형: 알파벳2 + 숫자7 (PM1234567)
    "여권번호": r'\b[A-Z](?:\d{8}|\d{3}[A-Z]\d{4}|[A-Z]\d{7})\b',
    # 운전면허번호: 공백/하이픈 변형 대응
    "운전면허번호": r'(?<!\d)\d{2}\s*[-]?\s*\d{2}\s*[-]?\s*\d{6}\s*[-]?\s*\d{2}(?!\d)',
    # 외국인등록번호: 공백/하이픈 변형 대응
    "외국인등록번호": r'(?<!\d)\d{6}\s*[-]?\s*[5-8]\d{6}(?!\d)',
    
    # --- 금융정보 (제34조의2 노출금지) ---
    # 계좌번호: 은행별 11~14자리, 공백/하이픈 변형 대응
    "계좌번호": r'(?<!\d)\d{3,6}\s*[-]?\s*\d{2,6}\s*[-]?\s*\d{3,7}(?!\d)',
    # 카드번호: 공백/하이픈 변형 대응 (16자리 4-4-4-4)
    "카드번호": r'(?<!\d)\d{4}\s*[-]?\s*\d{4}\s*[-]?\s*\d{4}\s*[-]?\s*\d{4}(?!\d)',
    
    # --- 일반 개인정보 (제2조) ---
    # 전화번호: 공백/하이픈 변형 대응
    "전화번호": r'(?<!\d)0(?:2|3[1-3]|4[1-4]|5[1-5]|6[1-4]|70)\s*[-]?\s*\d{3,4}\s*[-]?\s*\d{4}(?!\d)',
    # 휴대전화: 공백/하이픈 변형 대응
    "휴대전화": r'(?<!\d)01[016789]\s*[-]?\s*\d{3,4}\s*[-]?\s*\d{3,4}(?!\d)',
    "이메일": r'\b[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}\b',
    # 주소: 더 유연한 패턴 (시/도 포함, 번지까지)
    "주소": r'(서울|부산|대구|인천|광주|대전|울산|세종|경기|강원|충북|충남|전북|전남|경북|경남|제주)(?:특별시|광역시|특별자치시|특별자치도|시|도)?[\s]*[가-힣]+(?:시|군|구)[\s]*[가-힣]+(?:동|읍|면|리|로|길|가)[\s]*[\d\-\s번지층호]*',
    "IP주소": r'\b(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\b',
}

# ============================================================
# 컨텍스트 기반 탐지용 키워드 (false positive 방지)
# ============================================================
CONTEXT_KEYWORDS = {
    # 계좌번호 관련 컨텍스트
    "계좌번호": [
        "계좌", "계좌번호", "account", "입금", "송금", "이체", "출금", 
        "은행", "bank", "예금", "적금", "급여", "월급", "정산",
        "국민은행", "신한은행", "우리은행", "하나은행", "농협", "기업은행",
        "SC은행", "씨티은행", "카카오뱅크", "토스뱅크", "케이뱅크"
    ],
    # 주소 관련 컨텍스트
    "주소": [
        "주소", "address", "거주지", "소재지", "주거지", "자택",
        "회사주소", "직장주소", "배송지", "배송주소", "수령지",
        "우편번호", "zipcode", "우편", "택배"
    ],
    # 전화번호 관련 컨텍스트 (false positive 방지)
    "전화번호": [
        "전화", "연락처", "phone", "tel", "휴대폰", "핸드폰", "mobile",
        "연락", "통화", "문의", "담당자"
    ],
}

# ============================================================
# 민감정보 키워드 패턴 (제23조)
# ============================================================
SENSITIVE_KEYWORDS = {
    # 건강/의료 정보
    "건강정보": [
        "진단명", "병명", "질환", "질병", "암", "당뇨", "고혈압", "우울증", "치매",
        "HIV", "AIDS", "정신과", "정신건강", "장애등급", "장애인", "투석",
        "수술", "입원", "퇴원", "처방전", "의무기록", "건강검진", "검진결과",
        "혈액형", "알레르기", "복용약", "치료", "재활", "환자", "진료",
        "주치의", "담당의", "병원", "의원", "약물", "투약", "복용",
        "정신질환", "조현병", "양극성", "공황", "불안장애", "ADHD",
        "에스시탈로프람", "렉사프로", "졸피뎀", "자낙스", "항우울제"
    ],
    # 사상/신념/종교
    "사상_신념": [
        "종교", "신앙", "불교", "기독교", "천주교", "개신교", "이슬람", "무신론",
        "신자", "신도", "교인", "불자", "무슬림", "힌두교", "유대교",
        "목사", "신부", "스님", "승려", "집사", "장로", "권사", "전도사",
        "예배", "미사", "법회", "기도회", "수요예배", "주일예배",
        "교회", "성당", "절", "사찰", "모스크", "회당",
        "세례", "영세", "수계", "할례", "성찬", "고해성사",
        "신앙고백", "종교활동", "선교", "전도", "포교"
    ],
    # 노동조합/정당
    "노동조합_정당": [
        "노동조합", "노조", "조합원", "파업", "단체교섭", "단협",
        "민주노총", "한국노총", "산별노조", "기업노조", "노조가입",
        "민주당", "국민의힘", "정의당", "진보당", "녹색당",
        "당원", "정당가입", "당비", "입당", "탈당", "당적",
        "노조위원장", "노조대표", "파업참여", "쟁의행위", "태업"
    ],
    # 정치적 견해
    "정치적_견해": [
        "지지", "투표", "선거", "정치성향", "정치적 견해", "정치 성향",
        "보수", "진보", "좌파", "우파", "중도",
        "여당", "야당", "대통령", "국회의원",
        "정치활동", "정치참여", "시위", "집회", "촛불",
        "탄핵", "정권", "정부비판", "정책반대"
    ],
    # 성생활/성적 지향
    "성생활": [
        "성적지향", "동성애", "이성애", "양성애", "트랜스젠더", "LGBT", "성정체성",
        "게이", "레즈비언", "퀴어", "성소수자", "젠더", "논바이너리"
    ],
    # 범죄경력
    "범죄경력": [
        "전과", "범죄기록", "형사처벌", "구속", "기소", "수사기록",
        "범죄경력", "전과기록", "형사기록", "징역", "벌금형",
        "집행유예", "구속영장", "체포", "검찰", "경찰조사",
        "피의자", "피고인", "형사재판", "공판", "선고"
    ]
}

# ============================================================
# 기업기밀 키워드 패턴 (부정경쟁방지법 제2조 제2호)
# ============================================================
CONFIDENTIAL_KEYWORDS = {
    # 영업비밀 표시
    "영업비밀": [
        "영업비밀", "기업비밀", "대외비", "극비", "기밀", "비밀유지",
        "confidential", "secret", "proprietary", "internal only", 
        "restricted", "classified", "trade secret", "NDA"
    ],
    # 기술정보
    "기술정보": [
        "특허", "설계도", "도면", "회로도", "소스코드", "알고리즘",
        "제조공정", "제조방법", "기술사양", "스펙", "specification",
        "연구개발", "R&D", "프로토타입", "시제품", "핵심기술",
        "노하우", "know-how", "공정도", "배합비", "레시피"
    ],
    # 경영정보
    "경영정보": [
        "매출", "영업이익", "순이익", "실적", "재무제표", "손익계산서",
        "원가", "단가", "마진", "수익률", "예산", "결산",
        "거래처", "고객목록", "공급업체", "벤더", "파트너사",
        "입찰", "계약금액", "견적", "단가표", "가격표",
        "M&A", "인수합병", "투자", "지분", "주주"
    ],
    # 인사정보
    "인사급여": [
        "연봉", "급여", "월급", "성과급", "보너스", "인센티브",
        "호봉", "임금", "수당", "퇴직금", "스톡옵션",
        "인사평가", "고과", "승진", "해고", "징계", "감봉"
    ],
    # 전략정보
    "전략정보": [
        "사업계획", "전략", "로드맵", "신사업", "신제품",
        "마케팅전략", "영업전략", "시장분석", "경쟁사분석",
        "SWOT", "시장점유율", "목표시장", "타겟", "출시일정"
    ]
}


# ============================================================
# 정보 분류별 위험도 가중치
# ============================================================
# 법적 제한 강도 및 피해 심각성 기준

SEVERITY_WEIGHTS = {
    # 고유식별정보 (제24조) - 최고 위험
    "주민등록번호": 15,      # 개인 완전 식별 + 금융/행정 악용 가능 (체크섬 통과)
    "주민등록번호(의심)": 12,  # 2020.10 이후 출생 (체크섬 검증 불가)
    "외국인등록번호": 15,    # 주민등록번호와 동급 (체크섬 통과)
    "외국인등록번호(의심)": 12,  # 2020.10 이후 발급 (체크섬 검증 불가)
    "여권번호": 12,          # 국제적 신원 도용 위험
    "여권번호(의심)": 8,      # 형식 불확실
    "운전면허번호": 10,      # 신원 확인 수단
    "운전면허번호(의심)": 7,  # 체크디짓 실패
    "운전면허번호(API확인)": 12,  # API로 진위 확인됨 (확정)
    "운전면허번호(API불일치)": 3,  # API 검증 결과 불일치 (낮은 위험)
    
    # 금융정보 (제34조의2) - 고위험
    # 카드번호: Luhn 실패 시 의심으로 분류
    "카드번호": 12,          # 직접적 금전 피해 가능 (Luhn 통과)
    "카드번호(의심)": 8,      # Luhn 실패
    "계좌번호": 10,          # 금융사기 악용 가능
    "계좌번호(의심)": 6,      # 컨텍스트 부족
    
    # 민감정보 (제23조) - 고위험
    "건강정보": 10,          # 사생활 현저한 침해
    "사상_신념": 8,
    "노동조합_정당": 8,
    "정치적_견해": 8,        # 정치적 견해
    "성생활": 8,
    "범죄경력": 10,
    
    # 기업기밀 (부정경쟁방지법) - 고위험
    "영업비밀": 12,          # 직접적 표시가 있는 기밀
    "기술정보": 10,          # 핵심 기술 유출
    "경영정보": 10,          # 재무/거래처 정보
    "인사급여": 8,           # 급여/인사 정보
    "전략정보": 9,           # 사업 전략
    
    # 일반 개인정보 (제2조) - 중간 위험
    "주소": 6,               # 물리적 위치 노출
    "전화번호": 5,
    "휴대전화": 5,
    "이메일": 4,
    "IP주소": 3,
}

# ============================================================
# 정보 유형별 법적 분류 매핑
# ============================================================
INFO_LEGAL_CATEGORY = {
    # 고유식별정보
    "주민등록번호": "고유식별정보",
    "주민등록번호(의심)": "고유식별정보",
    "여권번호": "고유식별정보",
    "여권번호(의심)": "고유식별정보",
    "운전면허번호": "고유식별정보",
    "운전면허번호(의심)": "고유식별정보",
    "운전면허번호(API확인)": "고유식별정보",  # API로 진위 확인됨
    "운전면허번호(API불일치)": "고유식별정보",  # API 검증 불일치
    "외국인등록번호": "고유식별정보",
    "외국인등록번호(의심)": "고유식별정보",
    
    # 금융정보 (노출금지)
    "계좌번호": "금융정보",
    "계좌번호(의심)": "금융정보",
    "카드번호": "금융정보",  # Luhn 실패 시 제외, 의심 없음
    
    # 민감정보
    "건강정보": "민감정보",
    "사상_신념": "민감정보",
    "노동조합_정당": "민감정보",
    "정치적_견해": "민감정보",
    "성생활": "민감정보",
    "범죄경력": "민감정보",
    
    # 기업기밀
    "영업비밀": "기업기밀",
    "기술정보": "기업기밀",
    "경영정보": "기업기밀",
    "인사급여": "기업기밀",
    "전략정보": "기업기밀",
    
    # 일반 개인정보
    "전화번호": "일반개인정보",
    "휴대전화": "일반개인정보",
    "이메일": "일반개인정보",
    "주소": "일반개인정보",
    "IP주소": "일반개인정보",
}

# 법적 분류별 설명
LEGAL_CATEGORY_DESCRIPTIONS = {
    "고유식별정보": "제24조 - 처리 제한, 암호화 의무, 별도 동의 필요",
    "민감정보": "제23조 - 원칙적 처리 금지, 별도 동의 필요",
    "금융정보": "제34조의2 - 정보통신망 노출 금지",
    "기업기밀": "부정경쟁방지법 제2조 - 영업비밀 보호, 유출 시 형사처벌",
    "일반개인정보": "제2조 - 개인정보 처리 기본 원칙 적용"
}

# ============================================================
# 위험도 레벨 및 색상
# ============================================================
RISK_LEVELS = {
    "낮음": (0, 24),
    "보통": (25, 49),
    "높음": (50, 74),
    "심각": (75, 100)
}

RISK_COLORS = {
    "낮음": "#4CAF50",   # 녹색
    "보통": "#FFC107",   # 노랑
    "높음": "#FF9800",   # 주황
    "심각": "#F44336"    # 빨강
}

# 하이라이트 색상 (RGB)
HIGHLIGHT_COLORS = {
    # 고유식별정보 - 빨강 계열
    "주민등록번호": (255, 80, 80),
    "주민등록번호(의심)": (255, 120, 120),  # 2020.10 이후 출생 (체크섬 검증 불가)
    "외국인등록번호": (255, 80, 80),
    "외국인등록번호(의심)": (255, 120, 120),  # 2020.10 이후 발급 (체크섬 검증 불가)
    "여권번호": (255, 100, 100),
    "여권번호(의심)": (255, 180, 180),  # 연한 빨강 (형식 불확실)
    "운전면허번호": (255, 120, 100),
    "운전면허번호(의심)": (255, 190, 180),  # 연한 빨강 (체크디짓 실패)
    "운전면허번호(API확인)": (220, 50, 50),  # 진한 빨강 (API로 확인됨)
    "운전면허번호(API불일치)": (180, 180, 180),  # 회색 (불일치 - 낮은 위험)
    
    # 금융정보 - 보라 계열
    "계좌번호": (200, 100, 255),
    "계좌번호(의심)": (230, 180, 255),  # 연한 보라 (컨텍스트 부족)
    "카드번호": (180, 80, 220),  # Luhn 실패 시 제외, 의심 없음
    
    # 민감정보 - 주황 계열
    "건강정보": (255, 150, 50),
    "사상_신념": (255, 180, 100),
    "노동조합_정당": (255, 180, 100),
    "정치적_견해": (255, 170, 90),
    "성생활": (255, 160, 80),
    "범죄경력": (255, 140, 60),
    
    # 기업기밀 - 청록 계열
    "영업비밀": (0, 200, 200),
    "기술정보": (0, 180, 180),
    "경영정보": (50, 200, 180),
    "인사급여": (80, 180, 160),
    "전략정보": (30, 190, 190),
    
    # 일반 개인정보 - 파랑/녹색 계열
    "전화번호": (100, 180, 255),
    "휴대전화": (100, 180, 255),
    "이메일": (150, 200, 255),
    "주소": (100, 220, 150),
    "IP주소": (180, 180, 255),
    
    # 사용자정의 - 노란색/금색 계열
    "사용자정의": (255, 215, 0),
    
    "default": (255, 255, 100)
}

# ============================================================
# 유효성 검사용 상수
# ============================================================
VALID_PHONE_PREFIXES = [
    '02', '031', '032', '033', '041', '042', '043', '044',
    '051', '052', '053', '054', '055', '061', '062', '063', '064',
    '070'
]

VALID_MOBILE_PREFIXES = ['010', '011', '016', '017', '018', '019']

"""" #현재 사용x
# 코드 컨텍스트 키워드 (false positive 방지) 
CODE_KEYWORDS = [
    'int', 'long', 'double', 'float', 'char', 'String', 'boolean',
    'if', 'else', 'for', 'while', 'return', 'void', 'public', 'private',
    'class', 'import', 'package', 'def', 'lambda', 'async', 'await',
    'function', 'var', 'let', 'const', 'System.out', 'println', 'print',
    'printf', 'console.log', '++', '--', '==', '!=', '&&', '||',
    'true', 'false', 'null', 'None', 'undefined'
]
"""

# 계좌번호 컨텍스트 키워드
ACCOUNT_KEYWORDS = ['계좌', 'account', '입금', '송금', '이체', '출금', '은행', 'bank']
